<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Iceberg — AI‑Powered Real Estate Intelligence</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0b; --text:#f6f6f6; --muted:#bdbdbd;
      --btn-bg:#ffffff; --btn-text:#0b0b0b; --maxw:1240px;
      --accent:#2563eb;
      /* Auto-locked by JS on load (fallbacks below) */
      --demo-h: 420px;   /* overall demo card height (compressed) */
      --viz-h:  180px;   /* reserved infographic area (compressed) */
      /* Second section static vars */
      --demo2-h: 360px;
      --viz2-h:  180px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }

    /* ===== Sticky Top Navigation ===== */
    .nav-wrap{position:sticky;top:0;z-index:50;background:rgba(11,11,11,.92);backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{height:72px;display:flex;align-items:center;justify-content:space-between;max-width:var(--maxw);margin:0 auto;padding:0 28px}
    .brand{font-weight:600;font-size:20px;letter-spacing:.2px}
    .menu{display:flex;gap:24px}
    .menu-item{position:relative}
    .menu-item>a{color:var(--text);text-decoration:none;font-weight:500;font-size:15px;opacity:.92;transition:opacity .2s ease;display:flex;align-items:center;gap:4px}
    .menu-item>a:hover{opacity:.7}
    .menu-item>a::after{content:"▼";font-size:10px;opacity:.6;transition:transform .2s ease}
    .menu-item:hover>a::after{transform:rotate(180deg)}
    .dropdown{position:absolute;top:100%;left:50%;transform:translateX(-50%) translateY(-8px);background:rgba(11,11,11,.95);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px 0;min-width:200px;margin-top:6px;opacity:0;visibility:hidden;pointer-events:none;transition:opacity .2s ease,visibility .2s ease,transform .2s ease;box-shadow:0 12px 32px rgba(0,0,0,.4)}
    .menu-item:hover .dropdown{opacity:1;visibility:visible;pointer-events:auto;transform:translateX(-50%) translateY(0)}
    .dropdown a{display:block;padding:8px 16px;color:var(--text);text-decoration:none;font-size:14px;font-weight:400;opacity:.85;transition:all .15s ease}
    .dropdown a:hover{opacity:1;background:rgba(255,255,255,.05)}

    /* ===== Top Hero ===== */
    .hero{min-height:calc(90vh - 72px);display:flex;align-items:center;justify-content:center;padding:72px 20px 24px;position:relative;overflow:hidden}
    .hero::before{content:"";position:absolute;inset:-20% -20% 0 -20%;background:radial-gradient(60% 60% at 50% 35%, rgba(255,255,255,.06), transparent 65%),radial-gradient(50% 50% at 50% 100%, rgba(255,255,255,.03), transparent 60%);pointer-events:none;mix-blend-mode:screen;opacity:.6}
    .hero-inner{position:relative;width:100%;max-width:880px;text-align:center}
    .headline{font-family:"Playfair Display",Georgia,serif;font-weight:700;line-height:1.06;font-size:clamp(42px,7vw,84px);margin:0 0 14px}
    .sub{font-size:clamp(16px,2.2vw,20px);color:var(--muted);margin:0 0 22px}
    .cta{display:inline-block;padding:12px 18px;border-radius:12px;background:var(--btn-bg);color:var(--btn-text);text-decoration:none;font-weight:600;border:1px solid rgba(255,255,255,.08);box-shadow:0 10px 24px rgba(0,0,0,.35);transition:transform .06s ease, opacity .2s ease, box-shadow .2s ease}
    .cta:hover{transform:translateY(1px);opacity:.97;box-shadow:0 12px 28px rgba(0,0,0,.4)}

    /* ===== Split Demo Section (off-center half page) ===== */
    .split{padding:64px 20px 96px;background:linear-gradient(135deg,#f6f7fa 0%,#e9edf3 100%)}
    .split-inner{max-width:var(--maxw);margin:0 auto;display:grid;grid-template-columns:1.05fr 0.95fr;gap:28px;align-items:center}
    .panel-demo{display:flex;justify-content:center;transform:translateX(-3%)} /* off-center nudge */
    .panel-copy{display:flex;justify-content:flex-start}
    .copy-card{background:#111213;color:#fff;border-radius:20px;padding:22px 22px 24px;border:1px solid rgba(255,255,255,.06);box-shadow:0 10px 32px rgba(0,0,0,.25);max-width:520px}
    .copy-eyebrow{display:inline-block;font-size:.8rem;letter-spacing:.08em;text-transform:uppercase;color:#a9afba;margin-bottom:.4rem}
    .copy-title{font-family:"Playfair Display",Georgia,serif;font-size:clamp(30px,3.5vw,44px);line-height:1.08;margin:0 0 .5rem}
    .copy-sub{color:#cfd5de;font-size:clamp(14px,1.4vw,16px);line-height:1.5;margin:0 0 .9rem}
    .copy-cta{display:inline-block;background:#2563eb;color:#fff;text-decoration:none;font-weight:700;border-radius:12px;padding:10px 14px}

    /* ===== Demo Card (static shell) ===== */
    .demo-container{
      background:#fff;border-radius:22px;padding:28px;width:min(680px,100%);
      box-shadow:0 22px 70px rgba(0,0,0,.18);position:relative;overflow:hidden;

      /* Static shell via CSS vars (set by JS on load) */
      height: var(--demo-h);
      display: grid;
      grid-template-rows: auto auto auto 1fr; /* prompt / upload / button / results */
      align-content: start;
    }

    .prompt-text{font-size:clamp(20px,3.5vw,26px);font-weight:700;color:#111;line-height:1.24;margin-bottom:16px;opacity:0;transform:translateY(30px);transition:.5s}
    .upload-area{background:#f8f9fa;border:2px dashed #e1e5ea;border-radius:14px;padding:16px;text-align:center;margin-bottom:12px;opacity:0;transform:translateY(30px);transition:.5s .2s}
    .document-item{display:flex;align-items:center;justify-content:center;gap:10px;font-size:15px;font-weight:600;color:#374151}
    .doc-icon{font-size:18px}
    .analyze-button{width:100%;background:#2563eb;color:#fff;border:none;border-radius:14px;padding:12px 18px;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s ease;opacity:0;transform:translateY(30px);margin-bottom:12px;min-height:46px;white-space:nowrap}
    .typing-indicator{display:none;align-items:center;gap:8px;color:#4b5563;font-style:italic;margin-top:8px;min-height:20px}
    .typing-dots{display:flex;gap:4px}
    .typing-dots span{width:6px;height:6px;background:#6b7280;border-radius:50%;animation:typingBounce 1.4s infinite ease-in-out}
    .typing-dots span:nth-child(1){animation-delay:-.32s}.typing-dots span:nth-child(2){animation-delay:-.16s}

    .results-panel{
      background:#f8fafc;border:1px solid #e2e8f0;border-radius:14px;padding:18px;
      opacity:0;transform:translateY(20px);transition:.45s .6s;

      /* Fill remaining card height */
      height: 100%;
      display: grid;
      grid-template-rows: auto 1fr; /* title + viz */
      overflow: hidden;
    }
    .chart-title{font-size:16px;font-weight:700;color:#111;margin-bottom:10px;text-align:center}
    .chart-container{
      height: var(--viz-h);
      display:flex;align-items:center;justify-content:center;overflow:hidden;
    }

    /* Visuals respect reserved space */
    .line-chart, .bar-chart{ height:100%; width:100%; }
    .rent-table{ height:100%; overflow:auto; }

    /* Line chart styling */
    .line-chart{position:relative;background:linear-gradient(to bottom,rgba(37,99,235,.10) 0%,rgba(37,99,235,.05) 100%);border-radius:10px;padding:14px;display:flex;align-items:end;justify-content:space-between}
    .line-chart svg{position:absolute;inset:0;width:100%;height:100%}
    .chart-point{position:relative;z-index:2;text-align:center;display:flex;flex-direction:column;align-items:center;gap:6px}
    .point-value{background:#2563eb;color:#fff;padding:4px 8px;border-radius:16px;font-size:12px;font-weight:700;min-width:48px}
    .point-year{font-size:11px;color:#4b5563;font-weight:600}

    /* Bar chart styling */
    .bar-chart{display:flex;align-items:end;gap:14px;padding:14px;background:linear-gradient(to top,rgba(16,185,129,.10) 0%,rgba(16,185,129,.05) 100%);border-radius:10px}
    .bar-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px}
    .bar{background:linear-gradient(to top,#10b981,#34d399);border-radius:6px 6px 0 0;width:100%;min-height:16px;position:relative}
    .bar-value{position:absolute;top:-22px;left:50%;transform:translateX(-50%);background:#10b981;color:#fff;padding:3px 6px;border-radius:10px;font-size:11px;font-weight:700;white-space:nowrap}
    .bar-year{font-size:11px;color:#4b5563;font-weight:600}

    /* Table styling */
    .rent-table .table-row{display:grid;grid-template-columns:1fr 1fr 1fr;padding:10px;border-bottom:1px solid #e2e8f0;align-items:center}
    .rent-table .table-header{background:#f8fafc;font-weight:700;color:#374151;font-size:13px}
    .rent-table .table-cell{font-size:13px;color:#111;font-weight:600}
    .cagr-highlight{background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#fff;padding:3px 6px;border-radius:10px;font-weight:700;text-align:center}

    @keyframes typingBounce{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}

    /* ===== Second split (IcebergIR) — swapped sides ===== */
    .split-ir{
      padding:64px 20px 120px; /* extra bottom spacing */
      background:linear-gradient(180deg,#e9edf3 0%, #f6f7fa 100%);
    }
    .split-ir .split-inner{
      max-width:var(--maxw); margin:0 auto;
      display:grid; grid-template-columns:0.95fr 1.05fr; /* hero left, demo right */
      gap:28px; align-items:center;
    }
    .split-ir .panel-copy{ display:flex; justify-content:flex-end; }
    .split-ir .panel-demo{ display:flex; justify-content:center; transform:translateX(3%); } /* opposite nudge */

    .copy-card.ir{
      background:#111213;color:#fff;border-radius:20px;
      padding:22px 22px 24px;border:1px solid rgba(255,255,255,.06);
      box-shadow:0 10px 32px rgba(0,0,0,.25);max-width:520px
    }

    .demo-container.ir{
      background:#fff;border-radius:22px;padding:28px;width:min(680px,100%);
      box-shadow:0 22px 70px rgba(0,0,0,.18);position:relative;overflow:hidden;
      height:var(--demo2-h);
      display:grid; grid-template-rows:auto auto 1fr; align-content:start;
    }
    .prompt-text.ir{ margin-bottom:12px; opacity:1; transform:none }
    .ir-button{
      width:100%;background:#2563eb;color:#fff;border:none;border-radius:14px;
      padding:12px 18px;font-size:15px;font-weight:700;cursor:pointer;transition:.2s;
      margin-bottom:12px;min-height:46px;white-space:nowrap
    }
    .ir-results{
      background:#f8fafc;border:1px solid #e2e8f0;border-radius:14px;padding:16px;
      height:100%; display:grid; grid-template-rows:auto 1fr; overflow:hidden
    }
    .ir-title{font-size:16px;font-weight:700;color:#111;margin-bottom:8px;text-align:center}
    .ir-output{
      height:var(--viz2-h); overflow:auto; background:#fff;border-radius:10px;
      padding:14px;border:1px solid #eef2f6; font-size:14px; color:#111; line-height:1.6
    }
    .ir-output ul{margin:0 0 0 18px; padding:0}
    .ir-output li{margin:6px 0}

    .ir-cursor{
      display:inline-block; width:8px; height:1em; vertical-align:-2px;
      background:#111; animation:blink .9s steps(1,end) infinite
    }
    @keyframes blink{ 50%{ opacity:0 } }

    /* Responsive */
    @media (max-width:980px){
      .split-inner{grid-template-columns:1fr;gap:18px}
      .panel-demo{transform:none}
      .copy-card{max-width:unset}
      .split-ir .split-inner{ grid-template-columns:1fr; gap:18px }
      .split-ir .panel-demo{ transform:none }
      .copy-card.ir{ max-width:unset }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important}
    }
  </style>
</head>
<body>

  <!-- Sticky Nav -->
  <div class="nav-wrap">
    <header class="nav">
      <div class="brand">Iceberg</div>
      <nav class="menu" aria-label="Primary">
        <div class="menu-item">
          <a href="#">IcebergIC</a>
          <div class="dropdown">
            <a href="#">Value Comps</a><a href="#">Cap Rate Intel</a><a href="#">Occupancy Trends</a><a href="#">NOI and OpEx Comps</a><a href="#">Growth Rates</a>
          </div>
        </div>
        <div class="menu-item">
          <a href="#">IcebergIR</a>
          <div class="dropdown">
            <a href="#">Memo Narrative</a><a href="#">FAQ Prep</a><a href="#">Market Commentary</a>
          </div>
        </div>
        <div class="menu-item">
          <a href="#">IcebergREIT</a>
          <div class="dropdown">
            <a href="#">Portfolio Composition</a><a href="#">Valuation Analysis</a><a href="#">Peer Comparison</a>
          </div>
        </div>
        <div class="menu-item">
          <a href="#">IcebergBENCHMARK</a>
          <div class="dropdown"><a href="#">Underwriting Checks</a><a href="#">Actuals Comparisons</a></div>
        </div>
        <div class="menu-item">
          <a href="#">IcebergCUSTOM</a>
          <div class="dropdown"><a href="#">API Integration</a><a href="#">Private Iceberg Tool</a></div>
        </div>
      </nav>
    </header>
  </div>

  <!-- Top hero -->
  <main class="hero">
    <div class="hero-inner">
      <h1 class="headline">AI‑Powered Real Estate Intelligence</h1>
      <p class="sub">Domain‑specific AI intelligence and tools for managers, investors, brokers, and analysts.</p>
      <a class="cta" href="mailto:patrick@icebergre.ai?subject=Iceberg%20Demo%20Request">Request a Demo</a>
    </div>
  </main>

  <!-- SECTION 1: IcebergIC (demo left, hero right) -->
  <section class="split">
    <div class="split-inner">
      <!-- LEFT: demo -->
      <section class="panel-demo">
        <div class="demo-container" id="demoContainer" aria-live="polite">
          <div class="prompt-text" id="promptText">Analyze US data center cap rate trends</div>

          <div class="upload-area" id="uploadArea" role="region" aria-label="Uploaded document">
            <div class="document-item">
              <span class="doc-icon">📊</span>
              <span id="docName">US_DataCenter_CapRates.xlsx</span>
            </div>
          </div>

          <button class="analyze-button" id="analyzeBtn" type="button" aria-controls="resultsPanel">
            <span id="btnText">Analyze with IcebergIC</span>
          </button>

          <div class="typing-indicator" id="typingIndicator" role="status" aria-live="polite">
            <span>Processing data</span>
            <div class="typing-dots"><span></span><span></span><span></span></div>
          </div>

          <div class="results-panel" id="resultsPanel">
            <div class="chart-title" id="chartTitle"></div>
            <div class="chart-container" id="chartContainer"><!-- dynamic --></div>
          </div>
        </div>
      </section>

      <!-- RIGHT: hero copy -->
      <section class="panel-copy" aria-labelledby="copy-title">
        <div class="copy-card">
          <span class="copy-eyebrow">IcebergIC</span>
          <h2 id="copy-title" class="copy-title">Support Your Basis</h2>
          <p class="copy-sub">Use natural language search to find the comps you need</p>
          <a class="copy-cta" href="#how">Explore IcebergIC →</a>
        </div>
      </section>
    </div>
  </section>

  <!-- SECTION 2: IcebergIR (hero left, demo right) -->
  <section class="split-ir" id="icebergir">
    <div class="split-inner">

      <!-- LEFT: hero copy -->
      <section class="panel-copy" aria-labelledby="copy-title-ir">
        <div class="copy-card ir">
          <span class="copy-eyebrow">IcebergIR</span>
          <h2 id="copy-title-ir" class="copy-title">Draft Faster. Explain Better.</h2>
          <p class="copy-sub">Turn messy filings into clean, on‑brand bullet points and prose your team can actually use.</p>
          <a class="copy-cta" href="#icebergir">Explore IcebergIR →</a>
        </div>
      </section>

      <!-- RIGHT: text-only demo -->
      <section class="panel-demo">
        <div class="demo-container ir" id="irDemo" aria-live="polite">
          <div class="prompt-text ir" id="irPrompt">Write me 2 bullet points on NOI growth over the last 3 years</div>

          <button class="ir-button" id="irBtn" type="button">
            <span id="irBtnText">Generate with IcebergIR</span>
          </button>

          <div class="ir-results">
            <div class="ir-title">Draft</div>
            <div class="ir-output" id="irOutput">
              <!-- typing output appears here -->
            </div>
          </div>
        </div>
      </section>

    </div>
  </section>

  <!-- Scripts -->
  <script>
    /* ===================== Section 1: IcebergIC (charts) ===================== */

    let currentLoop = 0;
    let timers = [];
    const rm = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    const scenarios = [
      {
        prompt: "Analyze US data center cap rate trends",
        document: "US_DataCenter_CapRates.xlsx",
        icon: "📈",
        type: "line",
        title: "US Data Center Cap Rates (2022-2025)",
        data: [
          { year: "2022", value: "4.2%" },
          { year: "2023", value: "4.1%" },
          { year: "2024", value: "3.3%" },
          { year: "2025", value: "3.2%" }
        ]
      },
      {
        prompt: "Compare NoVa data center value comps",
        document: "NoVa_ValueComps_Analysis.xlsx",
        icon: "💰",
        type: "bar",
        title: "Northern Virginia Value per SF",
        data: [
          { year: "2022", value: "$1,364", height: 25 },
          { year: "2023", value: "$1,310", height: 20 },
          { year: "2024", value: "$1,846", height: 70 },
          { year: "2025", value: "$2,051", height: 95 }
        ]
      },
      {
        prompt: "Generate Chicago rent comp analysis",
        document: "Chicago_RentComps_Q4.xlsx",
        icon: "🏢",
        type: "table",
        title: "Chicago Data Center Rent Analysis",
        data: [
          { year: "2022", value: "$92.76" },
          { year: "2023", value: "$96.89" },
          { year: "2024", value: "$99.12" },
          { year: "2025", value: "$103.01" },
          { cagr: "3.6% CAGR" }
        ]
      }
    ];

    const byId  = id => document.getElementById(id);
    const q     = sel => document.querySelector(sel);
    function schedule(fn, ms){ const id = setTimeout(fn, ms); timers.push(id); }
    function clearTimers(){ timers.forEach(clearTimeout); timers = []; }
    function toNumber(s){ if(typeof s!=="string") return Number(s); return Number(s.replace(/[$,%\\s,]/g,"")); }

    function scaleBarHeights(data){
      const nums = data.map(d => toNumber(d.value));
      const min = Math.min(...nums), max = Math.max(...nums);
      const span = Math.max(1, max - min);
      return data.map(d => {
        const h = 25 + ((toNumber(d.value) - min) / span) * (95 - 25); // 25%..95%
        return { ...d, height: h };
      });
    }

    function createLineChart(data){
      return `
        <div class="line-chart">
          <svg>
            <path d="M 80 40 L 220 50 L 360 100 L 500 120"
                  stroke="#2563eb" stroke-width="3" fill="none"></path>
          </svg>
          ${data.map(p=>`
            <div class="chart-point">
              <div class="point-value">${p.value}</div>
              <div class="point-year">${p.year}</div>
            </div>`).join('')}
        </div>`;
    }
    function createBarChart(data, title){
      const scaled = scaleBarHeights(data);
      return `
        <div class="bar-chart">
          ${scaled.map(i=>`
            <div class="bar-item">
              <div class="bar" style="height:${i.height.toFixed(1)}%;">
                <div class="bar-value">${i.value}</div>
              </div>
              <div class="bar-year">${i.year}</div>
            </div>`).join('')}
        </div>`;
    }
    function createTable(data, title){
      return `
        <div class="rent-table">
          <div class="table-row table-header"><div>Year</div><div>Rent/SF</div><div>Growth</div></div>
          ${data.slice(0,4).map((item,i)=>{
            const base=toNumber(data[0].value), val=toNumber(item.value);
            const g=i===0?'Baseline':'+'+(((val/base)-1)*100).toFixed(1)+'%';
            return `
              <div class="table-row">
                <div class="table-cell">${item.year}</div>
                <div class="table-cell">${item.value}</div>
                <div class="table-cell">${g}</div>
              </div>`;
          }).join('')}
          <div class="table-row" style="background:#fef3c7;">
            <div class="table-cell" style="font-weight:700;">CAGR</div>
            <div class="table-cell cagr-highlight">${data[4].cagr}</div>
            <div class="table-cell"></div>
          </div>
        </div>`;
    }

    function measureScenarioHeight(html){
      const probe = document.createElement('div');
      probe.className = 'demo-container';
      probe.style.position='absolute';
      probe.style.visibility='hidden';
      probe.style.pointerEvents='none';
      probe.style.inset='0';
      probe.style.height='auto';
      probe.innerHTML = `
        <div class="prompt-text" style="opacity:1;transform:none">X</div>
        <div class="upload-area" style="opacity:1;transform:none"><div class="document-item">X</div></div>
        <button class="analyze-button" style="opacity:1;transform:none;min-height:46px">Analyze</button>
        <div class="results-panel" style="opacity:1;transform:none">
          <div class="chart-title">Title</div>
          <div class="chart-container" id="__probe_chart__">${html}</div>
        </div>`;
      document.body.appendChild(probe);
      const demoH = probe.offsetHeight;
      const vizH  = probe.querySelector('#__probe_chart__').offsetHeight;
      probe.remove();
      return { demoH, vizH };
    }

    function computeAndLockHeights(){
      const htmls = scenarios.map(s =>
        s.type==='line' ? createLineChart(s.data) :
        s.type==='bar'  ? createBarChart(s.data, s.title) :
                          createTable(s.data, s.title)
      );
      let maxDemo = 0, maxViz = 0;
      htmls.forEach(h => {
        const m = measureScenarioHeight(h);
        maxDemo = Math.max(maxDemo, m.demoH);
        maxViz  = Math.max(maxViz,  m.vizH);
      });
      maxDemo = Math.max(360, Math.round(maxDemo * 0.75));
      maxViz  = Math.max(160, Math.round(maxViz  * 0.75));
      document.documentElement.style.setProperty('--demo-h', `${maxDemo}px`);
      document.documentElement.style.setProperty('--viz-h',  `${maxViz}px`);
    }

    function resetDemo(){
      timers.forEach(clearTimeout); timers = [];
      const typing = byId('typingIndicator'); if (typing) typing.style.display='none';
      const btn = byId('analyzeBtn');
      if (btn){
        btn.style.background='#2563eb';
        btn.setAttribute('aria-busy','false');
        const btnText = byId('btnText'); if (btnText) btnText.textContent='Analyze with IcebergIC';
      }
      ['promptText','uploadArea','analyzeBtn'].forEach(id=>{
        const el = byId(id); if(!el) return;
        el.style.opacity='0'; el.style.transform='translateY(30px)';
      });
      const panel = byId('resultsPanel');
      if (panel){ panel.style.opacity='0'; panel.style.transform='translateY(20px)'; }
      const ct = byId('chartTitle');     if (ct) ct.textContent='';
      const cc = byId('chartContainer'); if (cc) cc.innerHTML='';
      setTimeout(startDemo, rm?0:250);
    }

    function startDemo(){
      const s = scenarios[currentLoop % scenarios.length];

      const p = byId('promptText'); if (p) p.textContent = s.prompt;
      const i = q('.doc-icon');     if (i) i.textContent = s.icon;
      const n = byId('docName');    if (n) n.textContent = s.document;
      const t = byId('chartTitle'); if (t) t.textContent = s.title;

      const step = rm ? 0 : 900;

      schedule(()=>{ const el=byId('promptText'); if(el){ el.style.opacity='1'; el.style.transform='translateY(0)'; } }, step*0.5);
      schedule(()=>{ const el=byId('uploadArea'); if(el){ el.style.opacity='1'; el.style.transform='translateY(0)'; } }, step*1.5);
      schedule(()=>{ const el=byId('analyzeBtn'); if(el){ el.style.opacity='1'; el.style.transform='translateY(0)'; } }, step*2.5);

      schedule(()=>{
        const btn = byId('analyzeBtn'); if(!btn) return;
        btn.style.background='#1d4ed8';
        btn.setAttribute('aria-busy','true');
        const btnText = byId('btnText'); if (btnText) btnText.textContent='Processing...';
        const typing = byId('typingIndicator'); if (typing) typing.style.display='flex';
      }, step*3.5);

      schedule(()=>{
        const typing = byId('typingIndicator'); if (typing) typing.style.display='none';
        const btn = byId('analyzeBtn'); if (btn){
          btn.style.background='#10b981';
          btn.setAttribute('aria-busy','false');
          const btnText = byId('btnText'); if (btnText) btnText.textContent='Analysis Complete ✓';
        }
        const s2 = scenarios[currentLoop % scenarios.length];
        const cc = byId('chartContainer');
        if (cc){
          cc.innerHTML = (s2.type==='line') ? createLineChart(s2.data)
                     : (s2.type==='bar')  ? createBarChart(s2.data, s2.title)
                                          : createTable(s2.data, s2.title);
        }
        const panel = byId('resultsPanel'); if (panel){ panel.style.opacity='1'; panel.style.transform='translateY(0)'; }
      }, step*4.5);

      schedule(()=>{ currentLoop++; resetDemo(); }, step*9);

      const btn = byId('analyzeBtn');
      if (btn){
        btn.onclick = () => {
          timers.forEach(clearTimeout); timers = [];
          btn.style.background='#1d4ed8';
          btn.setAttribute('aria-busy','true');
          const btnText = byId('btnText'); if (btnText) btnText.textContent='Processing...';
          const typing = byId('typingIndicator'); if (typing) typing.style.display='flex';
          setTimeout(()=>{
            if (typing) typing.style.display='none';
            btn.style.background='#10b981';
            btn.setAttribute('aria-busy','false');
            if (btnText) btnText.textContent='Analysis Complete ✓';
            const s3 = scenarios[currentLoop % scenarios.length];
            const cc = byId('chartContainer');
            if (cc){
              cc.innerHTML = (s3.type==='line') ? createLineChart(s3.data)
                         : (s3.type==='bar')  ? createBarChart(s3.data, s3.title)
                                              : createTable(s3.data, s3.title);
            }
            const panel = byId('resultsPanel'); if (panel){ panel.style.opacity='1'; panel.style.transform='translateY(0)'; }
          }, rm?0:800);
        };
      }
    }

    window.addEventListener('load', () => {
      try {
        computeAndLockHeights();
      } catch (e){
        document.documentElement.style.setProperty('--demo-h', '420px');
        document.documentElement.style.setProperty('--viz-h',  '180px');
        console && console.warn && console.warn('Sizing fallback:', e);
      } finally {
        setTimeout(startDemo, 300);
      }
    });


    /* ===================== Section 2: IcebergIR (text typing) ===================== */

    const irScenario = {
      prompt: "Write me 2 bullet points on NOI growth over the last 3 years",
      bullets: [
        "Strong upward trend: US data center rents per sq ft have increased dramatically from $116 in Q3 2022 to $290 in Q2 2025, representing a 150% increase over the ~3-year period.",
        "Recent acceleration: The most significant growth occurred in the latest quarters, with rents jumping from $227 to $290 between Q1 and Q2 2025, indicating accelerating demand and tightening supply in the data center market."
      ]
    };

    let irTimers = [];
    const irById = id => document.getElementById(id);
    function irSchedule(fn, ms){ const id = setTimeout(fn, ms); irTimers.push(id); }
    function irClear(){ irTimers.forEach(clearTimeout); irTimers = []; }

    function typeText(el, text, speed = 18){
      return new Promise(resolve=>{
        el.textContent = "";
        let i = 0;
        (function step(){
          el.textContent += text.charAt(i++);
          if(i <= text.length){ setTimeout(step, speed); }
          else resolve();
        })();
      });
    }

    async function typeBullets(container, bullets){
      container.innerHTML = "<ul></ul>";
      const ul = container.querySelector('ul');
      for (const line of bullets){
        const li = document.createElement('li');
        ul.appendChild(li);
        const span = document.createElement('span');
        li.appendChild(span);
        const cursor = document.createElement('span');
        cursor.className = 'ir-cursor';
        li.appendChild(cursor);
        await typeText(span, line, 16);
        cursor.remove();
        await new Promise(r=>setTimeout(r, 200));
      }
    }

    function resetIR(){
      irClear();
      const btn = irById('irBtn');
      const txt = irById('irBtnText');
      const out = irById('irOutput');
      if (btn && txt){ btn.style.background = '#2563eb'; txt.textContent = 'Generate with IcebergIR'; }
      if (out){ out.innerHTML = ''; }
      irSchedule(startIR, 400);
    }

    function startIR(){
      const p = irById('irPrompt'); if (p) p.textContent = irScenario.prompt;

      const btn = irById('irBtn'); const txt = irById('irBtnText');
      if (btn && txt){
        btn.onclick = fastForwardIR;
        btn.style.background = '#1d4ed8';
        txt.textContent = 'Thinking…';
      }

      irSchedule(async () => {
        const out = irById('irOutput'); if (!out) return;
        await typeBullets(out, irScenario.bullets);
        if (btn && txt){ btn.style.background = '#10b981'; txt.textContent = 'Draft Complete ✓'; }
        irSchedule(resetIR, 4000);
      }, 600);
    }

    function fastForwardIR(){
      irClear();
      const btn = irById('irBtn'); const txt = irById('irBtnText');
      const out = irById('irOutput');
      if (btn && txt){ btn.style.background = '#1d4ed8'; txt.textContent = 'Thinking…'; }
      if (!out) return;
      out.innerHTML = `<ul>
        <li>${irScenario.bullets[0]}</li>
        <li>${irScenario.bullets[1]}</li>
      </ul>`;
      if (btn && txt){ btn.style.background = '#10b981'; txt.textContent = 'Draft Complete ✓'; }
      irSchedule(resetIR, 3000);
    }

    window.addEventListener('load', () => {
      irSchedule(startIR, 800); // kick off the IR loop slightly after the first
    });
  </script>
</body>
</html>
